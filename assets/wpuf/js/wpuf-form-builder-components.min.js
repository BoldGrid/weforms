!function(e){"use strict";Vue.component("builder-stage",{template:"#tmpl-wpuf-builder-stage",mixins:wpuf_form_builder_mixins(wpuf_mixins.builder_stage),computed:{form_fields:function(){return this.$store.state.form_fields},field_settings:function(){return this.$store.state.field_settings},hidden_fields:function(){return this.$store.state.form_fields.filter(function(e){return"custom_hidden_field"===e.template})},editing_form_id:function(){return this.$store.state.editing_field_id},pro_link:function(){return wpuf_form_builder.pro_link}},mounted:function(){var t=this;e("#form-preview-stage .wpuf-form.sortable-list").sortable({placeholder:"form-preview-stage-dropzone",items:".field-items",handle:".control-buttons .move",scroll:!0,update:function(i,n){var o=n.item[0].dataset,s=o.source,l={toIndex:parseInt(e(n.item).index())};if("panel"===s){var f=n.item[0].dataset.formField,r=e.extend(!0,{},t.field_settings[f].field_props);r.id=t.get_random_id(),"yes"!==r.is_meta||r.name||(r.name=r.label.replace(/\W/g,"_").toLowerCase()+"_"+r.id),l.field=r,t.$store.commit("add_form_field_element",l),e(this).find(".button.ui-draggable.ui-draggable-handle").remove()}else"stage"===s&&(l.fromIndex=parseInt(o.index),t.$store.commit("swap_form_field_elements",l))}})},methods:{open_field_settings:function(e){this.$store.commit("open_field_settings",e)},clone_field:function(e,t){var i={field_id:e,index:t,new_id:this.get_random_id()},n=_.find(this.$store.state.form_fields,function(e){return parseInt(e.id)===parseInt(i.field_id)});this.isSingleInstance(n.template)&&this.containsField(n.template)?swal({title:"Oops...",text:"You already have this field in the form"}):this.$store.commit("clone_form_field_element",i)},delete_field:function(e){var t=this;swal({text:t.i18n.delete_field_warn_msg,type:"warning",showCancelButton:!0,confirmButtonColor:"#d54e21",confirmButtonText:t.i18n.yes_delete_it,cancelButtonText:t.i18n.no_cancel_it,confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(function(){t.$store.commit("delete_form_field_element",e),swal("Deleted!","The field has been deleted.","success")},function(){})},delete_hidden_field:function(e){var t=0;for(t=0;t<this.form_fields.length;t++)parseInt(e)===parseInt(this.form_fields[t].id)&&this.delete_field(t)},is_pro_feature:function(e){return!(!this.field_settings[e]||!this.field_settings[e].pro_feature)},is_template_available:function(e){var t=e.template;return this.field_settings[t]?!this.is_pro_feature(t):!!_.isFunction(this["is_"+t+"_template_available"])&&this["is_"+t+"_template_available"].call(this,e)},is_full_width:function(e){return!(!this.field_settings[e]||!this.field_settings[e].is_full_width)},is_invisible:function(e){return!(!e.recaptcha_type||"invisible_recaptcha"!==e.recaptcha_type)},get_field_name:function(e){return this.field_settings[e].title}}}),Vue.component("field-checkbox",{template:"#tmpl-wpuf-field-checkbox",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){var e=this.editing_form_field[this.option_field.name];if(this.option_field.is_single_opt){return e===Object.keys(this.option_field.options)[0]}return this.editing_form_field[this.option_field.name]},set:function(e){this.option_field.is_single_opt&&(e=e?Object.keys(this.option_field.options)[0]:""),this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:e})}}}}),Vue.component("field-html_help_text",{template:"#tmpl-wpuf-field-html_help_text",mixins:[wpuf_mixins.option_field_mixin]}),Vue.component("field-multiselect",{template:"#tmpl-wpuf-field-multiselect",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:e})}}},mounted:function(){this.bind_selectize()},methods:{bind_selectize:function(){var t=this;e(this.$el).find(".term-list-selector").selectize({}).on("change",function(){var i=e(this).val();t.value=i})}}}),Vue.component("field-option-data",{template:"#tmpl-wpuf-field-option-data",mixins:[wpuf_mixins.option_field_mixin],data:function(){return{show_value:!1,options:[],selected:[]}},computed:{field_options:function(){return this.editing_form_field.options},field_selected:function(){return this.editing_form_field.selected}},mounted:function(){var t=this;this.set_options(),e(this.$el).find(".option-field-option-chooser").sortable({items:".option-field-option",handle:".sort-handler",update:function(i,n){var o=n.item[0].dataset,s=parseInt(e(n.item).index()),l=parseInt(o.index);t.options.swap(l,s)}})},methods:{set_options:function(){var t=this,i=e.extend(!0,{},this.editing_form_field.options);_.each(i,function(e,i){t.options.push({label:e,value:i,id:t.get_random_id()})}),this.option_field.is_multiple&&!_.isArray(this.field_selected)?this.selected=[this.field_selected]:this.selected=this.field_selected},clear_selection:function(){this.selected=null},add_option:function(){var e=this.options.length,t=this.i18n.option+"-"+(e+1);this.options.push({label:t,value:t,id:this.get_random_id()})},delete_option:function(e){1!==this.options.length?this.options.splice(e,1):this.warn({text:this.i18n.last_choice_warn_msg,showCancelButton:!1,confirmButtonColor:"#46b450"})},set_option_label:function(e,t){this.options[e].value=t.toLocaleLowerCase().replace(/\s/g,"_")}},watch:{options:{deep:!0,handler:function(e){var t={},i=0;for(i=0;i<e.length;i++)t[e[i].value]=e[i].label;this.update_value("options",t)}},selected:function(e){this.update_value("selected",e)}}}),Vue.component("field-option-pro-feature-alert",{template:"#tmpl-wpuf-field-option-pro-feature-alert",mixins:[wpuf_mixins.option_field_mixin],computed:{pro_link:function(){return wpuf_form_builder.pro_link}}}),Vue.component("field-options",{template:"#tmpl-wpuf-field-options",mixins:wpuf_form_builder_mixins(wpuf_mixins.field_options),data:function(){return{show_basic_settings:!0,show_advanced_settings:!1,show_quiz_settings:!1}},computed:{editing_field_id:function(){return this.show_basic_settings=!0,this.show_advanced_settings=!1,this.show_quiz_settings=!1,parseInt(this.$store.state.editing_field_id)},editing_form_field:function(){var e=this;return _.find(this.$store.state.form_fields,function(t){return parseInt(t.id)===parseInt(e.editing_field_id)})},settings:function(){var e=[],t=this.editing_form_field.template;return e=_.isFunction(this["settings_"+t])?this["settings_"+t].call(this,this.editing_form_field):this.$store.state.field_settings[t].settings,_.sortBy(e,function(e){return parseInt(e.priority)})},basic_settings:function(){return this.settings.filter(function(e){return"basic"===e.section})},advanced_settings:function(){return this.settings.filter(function(e){return"advanced"===e.section})},quiz_settings:function(){return this.settings.filter(function(e){return"quiz"===e.section})},form_field_type_title:function(){var e=this.editing_form_field.template;return _.isFunction(this["form_field_"+e+"_title"])?this["form_field_"+e+"_title"].call(this,this.editing_form_field):this.$store.state.field_settings[e].title},form_settings:function(){return this.$store.state.settings}},watch:{form_settings:function(){return this.$store.state.settings}}}),Vue.component("field-radio",{template:"#tmpl-wpuf-field-radio",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:e})}}}}),Vue.component("field-select",{template:"#tmpl-wpuf-field-select",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:e})}}}}),Vue.component("field-text",{template:"#tmpl-wpuf-field-text",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.update_value(this.option_field.name,e)}}},methods:{on_focusout:function(e){wpuf_form_builder.event_hub.$emit("field-text-focusout",e,this)},on_keyup:function(e){wpuf_form_builder.event_hub.$emit("field-text-keyup",e,this)}}}),Vue.component("field-text-meta",{template:"#tmpl-wpuf-field-text-meta",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.update_value(this.option_field.name,e)}}},created:function(){"yes"===this.editing_form_field.is_meta&&(this.value||(this.value=this.editing_form_field.label.replace(/\W/g,"_").toLowerCase()),wpuf_form_builder.event_hub.$on("field-text-keyup",this.meta_key_autocomplete))},methods:{meta_key_autocomplete:function(e,t){"label"===t.option_field.name&&parseInt(this.editing_form_field.id)===parseInt(t.editing_form_field.id)&&(this.value=t.value.replace(/\W/g,"_").toLowerCase())}}}),Vue.component("field-textarea",{template:"#tmpl-wpuf-field-textarea",mixins:[wpuf_mixins.option_field_mixin],computed:{value:{get:function(){return this.editing_form_field[this.option_field.name]},set:function(e){this.update_value(this.option_field.name,e)}}}}),Vue.component("field-visibility",{template:"#tmpl-wpuf-field-visibility",mixins:[wpuf_mixins.option_field_mixin],computed:{selected:{get:function(){return this.editing_form_field[this.option_field.name].selected},set:function(e){this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:{selected:e,choices:[]}})}},choices:{get:function(){return this.editing_form_field[this.option_field.name].choices},set:function(e){this.$store.commit("update_editing_form_field",{editing_field_id:this.editing_form_field.id,field_name:this.option_field.name,value:{selected:this.selected,choices:e}})}}},methods:{},watch:{selected:function(e){this.update_value("selected",e)}}}),Vue.component("form-checkbox_field",{template:"#tmpl-wpuf-form-checkbox_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-custom_hidden_field",{template:"#tmpl-wpuf-form-custom_hidden_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-custom_html",{template:"#tmpl-wpuf-form-custom_html",mixins:[wpuf_mixins.form_field_mixin],data:function(){return{raw_html:"<p>from data</p>"}}}),Vue.component("form-dropdown_field",{template:"#tmpl-wpuf-form-dropdown_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-email_address",{template:"#tmpl-wpuf-form-email_address",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-featured_image",{template:"#tmpl-wpuf-form-featured_image",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-fields",{template:"#tmpl-wpuf-form-fields",mixins:wpuf_form_builder_mixins(wpuf_mixins.form_fields),computed:{panel_sections:function(){return this.$store.state.panel_sections},field_settings:function(){return this.$store.state.field_settings},form_fields:function(){return this.$store.state.form_fields}},mounted:function(){e(this.$el).find(".panel-form-field-buttons .button").draggable({connectToSortable:"#form-preview-stage .wpuf-form",helper:"clone",revert:"invalid",cancel:".button-faded"}).disableSelection()},methods:{panel_toggle:function(e){this.$store.commit("panel_toggle",e)},add_form_field:function(t){var i={toIndex:this.$store.state.form_fields.length};if(this.isSingleInstance(t)&&this.containsField(t))swal({title:"Oops...",text:"You already have this field in the form"});else{var n=e.extend(!0,{},this.$store.state.field_settings[t].field_props);if(n.id=this.get_random_id(),!n.name&&n.label){n.name=n.label.replace(/\W/g,"_").toLowerCase();var o=this.form_fields.filter(function(e){return e.template===n.template});o.length&&(n.name+="_"+o.length)}i.field=n,this.$store.commit("add_form_field_element",i)}},is_pro_feature:function(e){return this.field_settings[e].pro_feature},alert_pro_feature:function(e){var t=this.field_settings[e].title;swal({title:'<i class="fa fa-lock"></i> '+t+" <br>"+this.i18n.is_a_pro_feature,text:this.i18n.pro_feature_msg,type:"",showCancelButton:!0,cancelButtonText:this.i18n.close,confirmButtonColor:"#46b450",confirmButtonText:this.i18n.upgrade_to_pro}).then(function(e){e&&window.open(wpuf_form_builder.pro_link,"_blank")},function(){})},alert_invalidate_msg:function(e){var t=this.field_settings[e].validator;t&&t.msg&&this.warn({title:t.msg_title||"",html:t.msg,type:"warning",showCancelButton:!1,confirmButtonColor:"#46b450",confirmButtonText:this.i18n.ok})},get_invalidate_btn_class:function(e){return this.field_settings[e].validator.button_class}}}),Vue.component("form-image_upload",{template:"#tmpl-wpuf-form-image_upload",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-multiple_select",{template:"#tmpl-wpuf-form-multiple_select",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-post_content",{template:"#tmpl-wpuf-form-post_content",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-post_excerpt",{template:"#tmpl-wpuf-form-post_excerpt",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-post_tags",{template:"#tmpl-wpuf-form-post_tags",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-post_title",{template:"#tmpl-wpuf-form-post_title",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-radio_field",{template:"#tmpl-wpuf-form-radio_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-recaptcha",{template:"#tmpl-wpuf-form-recaptcha",mixins:[wpuf_mixins.form_field_mixin],computed:{has_recaptcha_api_keys:function(){return!(!wpuf_form_builder.recaptcha_site||!wpuf_form_builder.recaptcha_secret)},no_api_keys_msg:function(){return wpuf_form_builder.field_settings.recaptcha.validator.msg}}}),Vue.component("form-section_break",{template:"#tmpl-wpuf-form-section_break",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-taxonomy",{template:"#tmpl-wpuf-form-taxonomy",mixins:[wpuf_mixins.form_field_mixin],computed:{terms:function(){var e;for(e in wpuf_form_builder.wp_post_types){var t=wpuf_form_builder.wp_post_types[e];if(t.hasOwnProperty(this.field.name)){var i=t[this.field.name];if(i.terms)return i.terms}}return[]},sorted_terms:function(){var t=this,i=e.extend(!0,[],this.terms);if(this.field.exclude_type&&this.field.exclude){if(this.field.exclude.length>1)var n=this.field.exclude.split(",").map(function(e){return e=e.trim(),e=parseInt(e)}).filter(function(e){return isFinite(e)});i=i.filter(function(e){switch(t.field.exclude_type){case"exclude":return _.indexOf(n,e.term_id)<0;case"include":return _.indexOf(n,e.term_id)>=0;case"child_of":return _.indexOf(n,parseInt(e.parent))>=0}})}i=_.sortBy(i,function(e){return e[t.field.orderby]}),"DESC"===this.field.order&&(i=i.reverse());var o=i.filter(function(e){return!e.parent});return o.map(function(e){e.children=t.get_child_terms(e.term_id,i)}),o.length?o:i}},methods:{get_child_terms:function(e,t){var i=this,n=t.filter(function(t){return parseInt(t.parent)===parseInt(e)});return n.map(function(e){e.children=i.get_child_terms(e.term_id,t)}),n},get_term_dropdown_options:function(){var e=this,t="";return"select"===this.field.type&&(t='<option value="">'+this.field.first+"</option>"),_.each(e.sorted_terms,function(i){t+=e.get_term_dropdown_options_children(i,0)}),t},get_term_dropdown_options_children:function(e,t){var i=this,n="",o="",s=0;for(s=0;s<t;s++)o+="&nbsp;&nbsp;";return n+='<option value="'+e.id+'">'+o+e.name+"</option>",e.children.length&&_.each(e.children,function(e){n+=i.get_term_dropdown_options_children(e,t+1)}),n},get_term_checklist:function(){var e=this,t="";return t+='<ul class="wpuf-category-checklist">',_.each(this.sorted_terms,function(i){t+=e.get_term_checklist_li(i)}),t+="</ul>"},get_term_checklist_li:function(e){var t=this,i="";return i+='<li><label class="selectit"><input type="checkbox"> '+e.name+"</label></li>",e.children.length&&(i+='<ul class="children">',_.each(e.children,function(e){i+=t.get_term_checklist_li(e)}),i+="</ul>"),i},get_term_checklist_inline:function(){var e=this,t="";return _.each(this.sorted_terms,function(i){t+=e.get_term_checklist_li_inline(i)}),t},get_term_checklist_li_inline:function(e){var t=this,i="";return i+='<label class="wpuf-checkbox-inline"><input type="checkbox"> '+e.name+"</label>",e.children.length&&_.each(e.children,function(e){i+=t.get_term_checklist_li_inline(e)}),i}}}),Vue.component("form-text_field",{template:"#tmpl-wpuf-form-text_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-textarea_field",{template:"#tmpl-wpuf-form-textarea_field",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("form-website_url",{template:"#tmpl-wpuf-form-website_url",mixins:[wpuf_mixins.form_field_mixin]}),Vue.component("help-text",{template:"#tmpl-wpuf-help-text",props:{text:{type:String,default:""}},mounted:function(){e(".wpuf-tooltip").tooltip()}}),Vue.component("text-editor",{template:"#tmpl-wpuf-text-editor",props:["rich"],computed:{site_url:function(){return wpuf_form_builder.site_url},is_full:function(){return"yes"===this.rich}}})}(jQuery);