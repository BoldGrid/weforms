!function(l){window.WPUF_Uploader=function(e,t,i,n,a,o){if(this.removed_files=[],this.container=t,this.browse_button=e,this.max=i||1,this.count=l("#"+t).find(".wpuf-attachment-list > li").length,this.perFileCount=0,this.UploadedFiles=0,l("#"+e).length)return l("ul.wpuf-attachment-list").sortable({placeholder:"highlight"}),l("ul.wpuf-attachment-list").disableSelection(),this.uploader=new plupload.Uploader({runtimes:"html5,html4",browse_button:e,container:t,multipart:!0,multipart_params:{action:"wpuf_upload_file",form_id:l("#"+e).data("form_id")},max_file_count:2,multiple_queues:!1,multi_selection:"wpuf-avatar-pickfiles"!=e&&"wpuf-featured_image-pickfiles"!=e,urlstream_upload:!0,file_data_name:"wpuf_file",max_file_size:o+"kb",url:wpuf_frontend_upload.plupload.url+"&type="+n,flash_swf_url:wpuf_frontend_upload.flash_swf_url,filters:[{title:"Allowed Files",extensions:a}]}),this.uploader.bind("Init",l.proxy(this,"init")),this.uploader.bind("FilesAdded",l.proxy(this,"added")),this.uploader.bind("QueueChanged",l.proxy(this,"upload")),this.uploader.bind("UploadProgress",l.proxy(this,"progress")),this.uploader.bind("Error",l.proxy(this,"error")),this.uploader.bind("FileUploaded",l.proxy(this,"uploaded")),this.uploader.init(),l("#"+t).on("click","a.attachment-delete",l.proxy(this.removeAttachment,this)),this.uploader},WPUF_Uploader.prototype={init:function(e,t){this.showHide(),l("#"+this.container).prepend('<div class="wpuf-file-warning"></div>')},showHide:function(){if(this.count>=this.max)return this.count,this.max,l("#"+this.container+" .wpuf-file-warning").html(wpuf_frontend_upload.warning),void l("#"+this.container).find(".file-selector").hide();l("#"+this.container+" .wpuf-file-warning").html(""),l("#"+this.container).find(".file-selector").show()},added:function(e,t){var i=l("#"+this.container).find(".wpuf-attachment-upload-filelist");this.showHide(),l.each(t,function(e,t){l(".wpuf-submit-button").attr("disabled","disabled"),i.append('<div class="upload-item" id="'+t.id+'"><div class="progress progress-striped active"><div class="bar"></div></div><div class="filename original">'+t.name+" ("+plupload.formatSize(t.size)+") <b></b></div></div>")}),e.refresh(),e.start()},upload:function(e){this.count=e.files.length-this.removed_files.length,this.showHide()},progress:function(e,t){var i=l("#"+t.id);l(".bar",i).css({width:t.percent+"%"}),l(".percent",i).html(t.percent+"%")},error:function(e,t){l("#"+this.container).find("#"+t.file.id).remove();var i="";switch(t.code){case-600:i=wpuf_frontend_upload.plupload.size_error;break;case-601:i=wpuf_frontend_upload.plupload.type_error;break;default:i="Error #"+t.code+": "+t.message}alert(i),this.count-=1,this.showHide(),this.uploader.refresh()},uploaded:function(e,t,i){if(l("#"+t.id+" b").html("100%"),l("#"+t.id).remove(),"error"!==i.response){this.perFileCount++,this.UploadedFiles++;var n=l("#"+this.container).find(".wpuf-attachment-list");if(n.append(i.response),this.perFileCount>this.max){var a=l(".wpuf-image-wrap:last a.attachment-delete",n).data("attach_id");this.removeExtraAttachment(a),l(".wpuf-image-wrap",n).last().remove(),this.perFileCount--}}else alert(i.error),this.count-=1,this.showHide();var o=this.UploadedFiles,r=e.files.length;if(l("ul.wpuf-attachment-list > li").length>=this.max&&l("#"+this.container).find(".file-selector").hide(),r===o){if("undefined"!=typeof grecaptcha&&!grecaptcha.getResponse().length)return;l(".wpuf-submit-button").removeAttr("disabled")}},removeAttachment:function(e){e.preventDefault();var t=this,i=l(e.currentTarget);swal({text:wpuf_frontend_upload.confirmMsg,type:"warning",showCancelButton:!0,confirmButtonColor:"#d54e21",confirmButtonText:wpuf_frontend_upload.delete_it,cancelButtonText:wpuf_frontend_upload.cancel_it,confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(function(){var e={attach_id:i.data("attach_id"),nonce:wpuf_frontend_upload.nonce,action:"wpuf_file_del"};t.removed_files.push(e),jQuery("#del_attach").val(i.data("attach_id")),jQuery.post(wpuf_frontend_upload.ajaxurl,e,function(){t.perFileCount--,i.parent().parent().remove(),t.count-=1,t.showHide(),t.uploader.refresh()})})},removeExtraAttachment:function(e){var t=this,i={attach_id:e,nonce:wpuf_frontend_upload.nonce,action:"wpuf_file_del"};this.removed_files.push(i),jQuery.post(wpuf_frontend_upload.ajaxurl,i,function(){t.count-=1,t.showHide(),t.uploader.refresh()})}}}(jQuery);